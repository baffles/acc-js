(function(){var $,QuoteExtension,quoteExtension;QuoteExtension=function(){function QuoteExtension(){}return QuoteExtension.threadPageUrl=/\/forums\/(?:thread|reply)\/(\d+)(?:\/(\d+))?/,QuoteExtension.smileyImageUrl=/^\/forums\/smileys\/.*\.gif$/,QuoteExtension.quoteIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAQCAMAAADDGrRQAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAwBQTFRFAAAAmZmZw8PDy8vLz8/P09PT29vb4+Pj5+fn6ebm6+np6+vr7Onp7+3t7+3u7+7t7+/v8O3u8O7u8/Pz9PLy9PLz9/f3+Pf3+Pf4+Pj3+fj4/Pv8/Pz8////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgEGuBQAAAQB0Uk5T////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AFP3ByUAAAAYdEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My4zNqnn4iUAAACVSURBVChTXZDhDsIgDAb55obChs4xZDh8/8fEtoyYeYT+uJBLg8IPXyoKnwb0IRVyzvtuCPRze5e292ZOBYU1rKs5FRSWu1tMLdDIVFCY7GQNuBBjikkcOC+FEGiy8xoGnRSezi0PdsUD3SAFOpMVVzAM41HglcT561hq4dIT2pMrL7pSuM2EL+wELrQ/aI4L/04KlS//Ulwh/quwTAAAAABJRU5ErkJggg==",QuoteExtension.quoteSelectedIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAQCAMAAADDGrRQAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAwBQTFRFAAAA6hMT6Bwc9gAA9gEB9wQE9gUF9AYG8ggI8AkJ8A0N+QAA+gEB+QIC+QMDw8PDy8vLz8/P09PT29vb4+Pj5+fn6ebm6+np6+vr7Onp7+3t7+3u7+7t7+/v8O3u8O7u8/Pz9PLy9PLz9/f3+Pf3+Pf4+Pj3+fj4/Pv8/Pz8////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA34BpMQAAAQB0Uk5T////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AFP3ByUAAAAYdEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My4zNqnn4iUAAACrSURBVChTXZDZDoMgFETpvkytVVtcuohWrfT//48OIDHpIdyHCZwMCMwo4xH4Bg7ZFAporcdREiTPcG7oP70E1vvl1mkU7zZt08jZgEwJ1Peqlt7AoWkQKPMyl7CGrhu6IbIZrN4Z2pbzyExlkIid4VVV9WPFzCggTp2Bq8ytz5goTYvFzhnIyWXqWhhvuCSEXVj9za2ic5zenoSdp3ebDQ3hD0JmDf+ZM3h+Sp5mfXXRKz8AAAAASUVORK5CYII=",QuoteExtension.prototype.loadQuotes=function(threadID){var _ref;return null!=(_ref=JSON.parse(sessionStorage.getItem("quotes["+threadID+"]")))?_ref:{}},QuoteExtension.prototype.saveQuotes=function(threadID,quotes){return sessionStorage.setItem("quotes["+threadID+"]",JSON.stringify(quotes))},QuoteExtension.prototype.clearQuotes=function(threadID){return sessionStorage.removeItem("quotes["+threadID+"]")},QuoteExtension.prototype.updateQuoteButton=function($button,selected){return $("img",$button).attr("src",selected?QuoteExtension.quoteSelectedIcon:QuoteExtension.quoteIcon)},QuoteExtension.prototype.processPage=function(){var $generateQuotesButton,$post,$postToolbar,$quoteButton,quotes,threadID,threadLocked,_i,_len,_ref,_ref1,_this=this;if(threadID=null!=(_ref=window.location.href.match(QuoteExtension.threadPageUrl))?_ref[1]:void 0,threadLocked=$('span:contains("This thread is locked; no one can reply to it.")').length>0,null!=threadID&&!threadLocked){for(quotes=this.loadQuotes(threadID),_ref1=$("table.post"),_i=0,_len=_ref1.length;_len>_i;_i++)$post=_ref1[_i],$quoteButton=$("<a>").addClass("quote-button").attr("href","#").css("float","right").append($("<img>")),this.updateQuoteButton($quoteButton,null!=quotes[$post.id]),$quoteButton.click({$button:$quoteButton,postID:$post.id},function(e){var $button,postContent,postID,poster,url,_ref2;return e.preventDefault(),_ref2=e.data,$button=_ref2.$button,postID=_ref2.postID,null==quotes[postID]?($post=$("#"+postID+".post"),poster=$(".info > .member > .originator",$post).text(),url=$(".content > .header > .posted-on > a[name='"+postID+"']",$post).attr("href"),postContent=$(".content > div > .mockup",$post).html(),quotes[postID]={postID:postID,poster:poster,url:url,postContent:postContent}):delete quotes[postID],_this.updateQuoteButton($button,null!=quotes[postID]),_this.saveQuotes(threadID,quotes)}),$(".header",$post).append($quoteButton);return $generateQuotesButton=$("<span>").addClass("button"),$generateQuotesButton.append($("<img>").attr("src",QuoteExtension.quoteSelectedIcon).css("height","18px")),$generateQuotesButton.append($("<span>").text(" Add Quotes")),$generateQuotesButton.click(function(e){return e.preventDefault(),_this.appendQuotes(quotes)}),$postToolbar=$("#post_form .toolbar"),$postToolbar.append($generateQuotesButton),$("#post_form").submit(function(){return _this.clearQuotes(threadID)})}},QuoteExtension.prototype.appendQuotes=function(quotes){var $editor,generatedQuotes,val;return generatedQuotes=this.generateQuotes(quotes),generatedQuotes.length>0&&(generatedQuotes+="\n\n"),$editor=$("textarea[name=body]"),val=$editor.val().trim(),val.length>0&&(val+="\n\n"),val+=generatedQuotes,$editor.val(val)},QuoteExtension.prototype.generateQuotes=function(quotes){var generatedQuotes,post,postID;generatedQuotes=[];for(postID in quotes)post=quotes[postID],generatedQuotes.push(this.postToMarkup(post.postContent));return generatedQuotes.join("\n\n\n\n")},QuoteExtension.prototype.postToMarkup=function(postContent){var $quote,line;return $quote=$("<div>").html(postContent),$("p",$quote).replaceWith(function(){return""+$(this).html().trim()+"\n\n"}),$("br",$quote).replaceWith("\n"),$("span.url",$quote).replaceWith(""),$("div.quote_container",$quote).replaceWith(""),$("div.source-code",$quote).replaceWith(""),$("img",$quote).replaceWith(function(){var $img;return $img=$(this),$img.hasClass("math")?$($img.attr("alt")):QuoteExtension.smileyImageUrl.test($img.attr("src"))?$img.attr("alt"):"["+$img.attr("src")+"]"}),$("span.remote-thumbnail",$quote).replaceWith(function(){var imageSrc;return imageSrc=JSON.parse($("span.json",$(this))[0].innerText).src,imageSrc.startsWith("//")&&(imageSrc="http:"+imageSrc),"["+imageSrc+"]"}),$(".media-player",$quote).replaceWith(function(){var link;return link=$("a",$(this)).attr("href"),link.startsWith("//")&&(link="http:"+link),"["+link+"]"}),$("span.source-code",$quote).replaceWith(function(){return $("<code>").text($(this).text())}),$("div > input.spoiler").parent().replaceWith(""),$(".spoiler").replaceWith(function(){return"<spoiler>"+$(this).html().trim()+"</spoiler>"}),$("span.cuss").replaceWith(function(){return $("span",$(this)).text()}),function(){var _i,_len,_ref,_results;for(_ref=$quote.html().trim().split("\n"),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)line=_ref[_i],_results.push("> "+line);return _results}().join("\n").trim()},QuoteExtension}(),$=jQuery.noConflict(),quoteExtension=new QuoteExtension,$(function(){return quoteExtension.processPage()})}).call(this);